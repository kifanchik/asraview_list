<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASTRaview - –õ–∏—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Exo 2', sans-serif;
            background: #0F0B1A;
            color: #E0F7FA;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(0, 245, 255, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(184, 115, 51, 0.02) 0%, transparent 50%),
                linear-gradient(45deg, transparent 49%, rgba(46, 26, 71, 0.03) 50%, transparent 51%);
        }

        .character-sheet {
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            padding: 15mm;
            background: #0F0B1A;
            position: relative;
            overflow: hidden;
        }

        .character-sheet::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 245, 255, 0.02) 1px, transparent 1px),
                radial-gradient(circle at 90% 80%, rgba(184, 115, 51, 0.02) 1px, transparent 1px);
            background-size: 8pt 8pt;
            pointer-events: none;
            opacity: 0.3;
        }

        .header {
            height: 40mm;
            background: linear-gradient(135deg, #2E1A47 0%, #0F0B1A 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            margin-bottom: 12mm;
            box-shadow: 0 4px 20px rgba(0, 245, 255, 0.1);
        }

        .logo {
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 18pt;
            color: #00F5FF;
            text-shadow: 0 0 10px rgba(0, 245, 255, 0.5);
        }

        .sheet-title {
            font-family: 'Exo 2', sans-serif;
            font-weight: 600;
            font-size: 16pt;
            color: #E0F7FA;
        }

        .portrait-circle {
            width: 40mm;
            height: 40mm;
            border: 2px solid #00F5FF;
            border-radius: 50%;
            background: rgba(26, 20, 42, 0.5);
            box-shadow: 0 0 15px rgba(0, 245, 255, 0.3);
            flex-shrink: 0;
        }

        .main-content {
            display: flex;
            gap: 12mm;
            margin-bottom: 12mm;
        }

        .left-column, .right-column {
            flex: 1;
        }

        .section {
            background: rgba(26, 20, 42, 0.3);
            border-radius: 8px;
            padding: 8mm;
            margin-bottom: 8mm;
            border: 1px solid rgba(46, 26, 71, 0.5);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .section-title {
            font-family: 'Exo 2', sans-serif;
            font-weight: 700;
            font-size: 12pt;
            color: #00F5FF;
            margin-bottom: 8mm;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(0, 245, 255, 0.3);
        }

        .field-group {
            margin-bottom: 6mm;
        }

        .field-label {
            font-family: 'Exo 2', sans-serif;
            font-weight: 400;
            font-size: 10pt;
            color: #E0F7FA;
            margin-bottom: 2mm;
            display: block;
        }

        .field-input {
            width: 100%;
            background: rgba(26, 20, 42, 0.6);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 4px;
            padding: 4px 8px;
            color: #E0F7FA;
            font-family: 'Exo 2', sans-serif;
            font-size: 10pt;
            transition: all 0.3s ease;
        }

        .field-input:focus {
            outline: none;
            border-color: #00F5FF;
            box-shadow: 0 0 8px rgba(0, 245, 255, 0.4);
        }

        .field-line {
            border-bottom: 1px solid rgba(0, 245, 255, 0.4);
            min-height: 20px;
            margin-bottom: 4mm;
            background: transparent;
            border-top: none;
            border-left: none;
            border-right: none;
            border-radius: 0;
            padding: 2px 4px;
        }

        .checkbox-group {
            display: flex;
            gap: 15px;
            margin-bottom: 6mm;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .checkbox {
            width: 4mm;
            height: 4mm;
            border: 1px solid #00F5FF;
            background: transparent;
            cursor: pointer;
            position: relative;
            border-radius: 2px;
        }

        .checkbox:checked {
            background: #00F5FF;
            box-shadow: 0 0 8px rgba(0, 245, 255, 0.6);
        }

        .checkbox:checked::after {
            content: '‚úì';
            position: absolute;
            top: -2px;
            left: 0;
            color: #0F0B1A;
            font-size: 8px;
            font-weight: bold;
        }

        .attributes-table {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 6mm;
        }

        .attribute-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 8px;
            background: rgba(26, 20, 42, 0.4);
            border-radius: 4px;
            border: 1px solid rgba(46, 26, 71, 0.5);
        }

        .attribute-name {
            font-weight: 500;
            color: #E0F7FA;
        }

        .attribute-value {
            width: 30px;
            background: transparent;
            border: none;
            border-bottom: 1px solid #00F5FF;
            color: #00F5FF;
            text-align: center;
            font-weight: bold;
        }

        .note {
            font-style: italic;
            font-size: 8pt;
            color: #8A8A9E;
            margin-top: 4mm;
        }

        .spheres-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .sphere-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 8px;
            background: rgba(26, 20, 42, 0.4);
            border-radius: 4px;
            border: 1px solid rgba(46, 26, 71, 0.5);
        }

        .bonus-input {
            width: 40px;
            background: transparent;
            border: none;
            border-bottom: 1px solid #B87333;
            color: #B87333;
            text-align: center;
            font-weight: bold;
        }

        .racial-gift {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .level-energy {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .level-energy .field-group {
            margin-bottom: 0;
        }

        .bottom-section {
            background: rgba(26, 20, 42, 0.3);
            border-radius: 8px;
            padding: 12mm;
            border: 1px solid rgba(46, 26, 71, 0.5);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .skills-list, .inventory-list {
            margin-bottom: 8mm;
        }

        .skill-item {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
        }

        .skill-number {
            color: #B87333;
            font-weight: bold;
            margin-right: 8px;
            min-width: 20px;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .resources {
            display: flex;
            gap: 15px;
            margin-top: 6mm;
        }

        .resource-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .separator {
            height: 1px;
            background: rgba(46, 26, 71, 0.5);
            margin: 8mm 0;
        }

        .glow {
            text-shadow: 0 0 5px currentColor;
        }

        .inventory-detailed {
            margin-top: 8mm;
        }

        .inventory-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .inventory-column {
            display: flex;
            flex-direction: column;
        }

        .item-entry {
            display: flex;
            align-items: flex-start;
            margin-bottom: 8px;
            gap: 0;
        }

        .artifact-entry {
            background: rgba(26, 20, 42, 0.4);
            border-radius: 6px;
            padding: 8px;
            margin-bottom: 12px;
            border: 1px solid rgba(184, 115, 51, 0.3);
        }

        .item-list, .artifact-list {
            display: flex;
            flex-direction: column;
        }

        @media print {
            .character-sheet {
                margin: 0;
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="character-sheet">


        <div class="header">
            <div class="sheet-title">–õ–∏—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</div>
            <button id="downloadBtn" style="background: linear-gradient(135deg, #00F5FF, #0080FF); border: none; color: #0F0B1A; padding: 8px 16px; border-radius: 6px; font-weight: 600; cursor: pointer; font-family: 'Exo 2', sans-serif; transition: all 0.3s ease;">–°–∫–∞—á–∞—Ç—å PNG</button>
            <div class="logo glow">ASTRAVIEW</div>
        </div>

        <div class="main-content">
            <div class="left-column">
                <div class="section">
                    <div class="section-title">–û—Å–Ω–æ–≤–Ω–æ–µ</div>
                    
                    <div style="display: flex; gap: 12mm; align-items: flex-start; margin-bottom: 8mm;">
                        <div style="flex: 1;">
                            <div class="field-group">
                                <label class="field-label">–ò–º—è:</label>
                                <input type="text" class="field-input field-line">
                            </div>
                            
                            <div class="field-group">
                                <label class="field-label">–†–∞—Å–∞:</label>
                                <input type="text" class="field-input field-line">
                            </div>
                        </div>
                        <div class="portrait-circle" id="portraitCircle" style="cursor: pointer; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden;">
                            <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                            <div id="uploadText" style="text-align: center; color: #00F5FF; font-size: 10pt; opacity: 0.7;">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è<br>–∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ</div>
                            <img id="portraitImage" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%; display: none;">
                        </div>
                    </div>
                    
                    <div class="field-group">
                        <label class="field-label">–†–æ–ª—å:</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" class="checkbox" id="astral">
                                <label for="astral">–ê—Å—Ç—Ä–∞–ª—å–Ω—ã–π</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" class="checkbox" id="alien">
                                <label for="alien">–ò–Ω–æ—Ä–æ–¥–Ω—ã–π</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="field-group">
                        <label class="field-label">–í–Ω–µ—à–Ω–æ—Å—Ç—å:</label>
                        <textarea class="field-input" rows="3" style="resize: vertical;"></textarea>
                    </div>
                    
                    <div class="field-group">
                        <label class="field-label">–ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ:</label>
                        <input type="text" class="field-input field-line">
                    </div>
                    
                    <div class="field-group">
                        <label class="field-label">–¶–µ–ª—å:</label>
                        <input type="text" class="field-input field-line">
                    </div>
                    
                    <div class="field-group">
                        <label class="field-label">–ú–æ—Ç–∏–≤:</label>
                        <input type="text" class="field-input field-line">
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">–ê—Ç—Ä–∏–±—É—Ç—ã</div>
                    <div class="attributes-table">
                        <div class="attribute-item">
                            <span class="attribute-name">üß† –†–∞–∑—É–º:</span>
                            <input type="number" class="attribute-value" min="1">
                        </div>
                        <div class="attribute-item">
                            <span class="attribute-name">üí™ –í–æ–ª—è:</span>
                            <input type="number" class="attribute-value" min="1">
                        </div>
                        <div class="attribute-item">
                            <span class="attribute-name">ü¶æ –ö–æ–Ω–µ—á–Ω–æ—Å—Ç–∏:</span>
                            <input type="number" class="attribute-value" min="1">
                        </div>
                        <div class="attribute-item">
                            <span class="attribute-name">‚ù§Ô∏è –ü–ª–æ—Ç—å:</span>
                            <input type="number" class="attribute-value" min="1">
                        </div>
                    </div>
                </div>
            </div>

            <div class="right-column">
                <div class="section">
                    <div class="section-title">–°—Ñ–µ—Ä—ã –¥–µ–π—Å—Ç–≤–∏—è</div>
                    <div class="spheres-list">
                        <div class="sphere-item">
                            <span>–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ:</span>
                            <div style="display: flex; align-items: center; gap: 4px;">
                                <span>+</span>
                                <input type="number" class="bonus-input" min="0" max="2">
                            </div>
                        </div>
                        <div class="sphere-item">
                            <span>–í–ª–∏—è–Ω–∏–µ:</span>
                            <div style="display: flex; align-items: center; gap: 4px;">
                                <span>+</span>
                                <input type="number" class="bonus-input" min="0" max="2">
                            </div>
                        </div>
                        <div class="sphere-item">
                            <span>–ò–Ω–∂–µ–Ω–µ—Ä–∏—è:</span>
                            <div style="display: flex; align-items: center; gap: 4px;">
                                <span>+</span>
                                <input type="number" class="bonus-input" min="0" max="2">
                            </div>
                        </div>
                        <div class="sphere-item">
                            <span>–í—ã–∂–∏–≤–∞–Ω–∏–µ:</span>
                            <div style="display: flex; align-items: center; gap: 4px;">
                                <span>+</span>
                                <input type="number" class="bonus-input" min="0" max="2">
                            </div>
                        </div>
                    </div>
                    <div class="note">+2 –∫ –¥–≤—É–º, +1 –∫ –æ–¥–Ω–æ–π, 0 –∫ –æ–¥–Ω–æ–π</div>
                </div>

                <div class="section">
                    <div class="section-title">–†–∞—Å–æ–≤—ã–π –¥–∞—Ä</div>
                    
                    <div class="field-group">
                        <label class="field-label">–†–∞—Å–æ–≤—ã–π –¥–∞—Ä:</label>
                        <input type="text" class="field-input">
                    </div>
                    
                    <div class="racial-gift">
                        <div class="checkbox-item">
                            <input type="checkbox" class="checkbox" id="not-awakened">
                            <label for="not-awakened">–ù–µ –ø—Ä–æ–±—É–∂–¥—ë–Ω</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" class="checkbox" id="stage1">
                            <label for="stage1">–≠—Ç–∞–ø 1: –ò–Ω—Å—Ç–∏–Ω–∫—Ç</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" class="checkbox" id="stage2">
                            <label for="stage2">–≠—Ç–∞–ø 2: –ü–∞–º—è—Ç—å</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" class="checkbox" id="stage3">
                            <label for="stage3">–≠—Ç–∞–ø 3: –ü—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ</label>
                        </div>
                    </div>
                    
                    <div class="field-group" style="margin-top: 8mm;">
                        <label class="field-label">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                        <textarea class="field-input" rows="3" style="resize: vertical;"></textarea>
                    </div>
                </div>

                <div class="section">
                    <div class="level-energy">
                        <div class="field-group">
                            <label class="field-label">–£—Ä–æ–≤–µ–Ω—å:</label>
                            <input type="number" class="field-input" style="width: 60px;" min="1">
                        </div>
                        <div class="field-group">
                            <label class="field-label">‚ö° –≠–Ω–µ—Ä–≥–∏—è:</label>
                            <input type="number" class="field-input" style="width: 60px;" min="0">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="bottom-section">
            <div class="section-title">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –∏ —É–º–µ–Ω–∏—è</div>
            
            <div class="skills-list">
                <h4 style="color: #B87333; margin-bottom: 8px;">–£–º–µ–Ω–∏—è:</h4>
                <div class="skill-item">
                    <input type="text" class="field-input">
                </div>
                <div class="skill-item">
                    <input type="text" class="field-input">
                </div>
                <div class="skill-item">
                    <input type="text" class="field-input">
                </div>
                <div class="skill-item">
                    <input type="text" class="field-input">
                </div>
                <div class="skill-item">
                    <input type="text" class="field-input">
                </div>
            </div>

            <div class="separator"></div>

            <div class="inventory-grid">
                <div>
                    <div class="field-group">
                        <label class="field-label">‚öîÔ∏è –û—Ä—É–∂–∏–µ:</label>
                        <input type="text" class="field-input">
                    </div>
                    <div class="field-group">
                        <label class="field-label">üõ°Ô∏è –ë—Ä–æ–Ω—è:</label>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <input type="text" class="field-input" style="flex: 1;">
                            <span style="color: #B87333;">(–ö–î:</span>
                            <input type="number" class="field-input" style="width: 50px;">
                            <span style="color: #B87333;">)</span>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="field-group">
                        <label class="field-label">‚ú® –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã:</label>
                        <input type="text" class="field-input">
                    </div>
                </div>
            </div>

            <div class="resources">
                <div class="resource-item">
                    <label class="field-label">‚õΩ –¢–æ–ø–ª–∏–≤–æ:</label>
                    <input type="number" class="field-input" style="width: 60px;" min="0">
                </div>
                <div class="resource-item">
                    <label class="field-label">üíé –ö—Ä–∏—Å—Ç–∞–ª–ª—ã:</label>
                    <input type="number" class="field-input" style="width: 60px;" min="0">
                </div>
                <div class="resource-item">
                    <label class="field-label">üì¶ –ü—Ä–∏–ø–∞—Å—ã:</label>
                    <input type="number" class="field-input" style="width: 60px;" min="0">
                </div>
            </div>

            <div class="separator"></div>

            <div class="inventory-detailed">
                <div class="section-title" style="margin-bottom: 8mm;">–î–µ—Ç–∞–ª—å–Ω—ã–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
                
                <div class="inventory-sections">
                    <div class="inventory-column">
                        <h4 style="color: #00F5FF; margin-bottom: 8px; font-size: 11pt;">üì¶ –ü—Ä–µ–¥–º–µ—Ç—ã –∏ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ:</h4>
                        <div class="item-list">
                            <textarea class="field-input" placeholder="–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–µ–¥–º–µ—Ç–æ–≤, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è –∏ –ø—Ä–æ—á–∏—Ö –≤–µ—â–µ–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞..." rows="12" style="resize: vertical; width: 100%;"></textarea>
                        </div>
                    </div>

                    <div class="inventory-column">
                        <h4 style="color: #B87333; margin-bottom: 8px; font-size: 11pt;">‚ú® –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∏ –æ—Å–æ–±—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã:</h4>
                        <div class="artifact-list">
                            <div class="artifact-entry">
                                <input type="text" class="field-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞" style="margin-bottom: 4px;">
                                <div style="display: flex; gap: 8px; margin-bottom: 4px;">
                                    <input type="text" class="field-input" placeholder="–¢–∏–ø" style="flex: 1;">
                                    <input type="text" class="field-input" placeholder="–†–µ–¥–∫–æ—Å—Ç—å" style="flex: 1;">
                                </div>
                                <textarea class="field-input" placeholder="–≠—Ñ—Ñ–µ–∫—Ç –∏ –æ–ø–∏—Å–∞–Ω–∏–µ" rows="2" style="resize: vertical;"></textarea>
                            </div>
                            <div class="artifact-entry">
                                <input type="text" class="field-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞" style="margin-bottom: 4px;">
                                <div style="display: flex; gap: 8px; margin-bottom: 4px;">
                                    <input type="text" class="field-input" placeholder="–¢–∏–ø" style="flex: 1;">
                                    <input type="text" class="field-input" placeholder="–†–µ–¥–∫–æ—Å—Ç—å" style="flex: 1;">
                                </div>
                                <textarea class="field-input" placeholder="–≠—Ñ—Ñ–µ–∫—Ç –∏ –æ–ø–∏—Å–∞–Ω–∏–µ" rows="2" style="resize: vertical;"></textarea>
                            </div>
                            <div class="artifact-entry">
                                <input type="text" class="field-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞" style="margin-bottom: 4px;">
                                <div style="display: flex; gap: 8px; margin-bottom: 4px;">
                                    <input type="text" class="field-input" placeholder="–¢–∏–ø" style="flex: 1;">
                                    <input type="text" class="field-input" placeholder="–†–µ–¥–∫–æ—Å—Ç—å" style="flex: 1;">
                                </div>
                                <textarea class="field-input" placeholder="–≠—Ñ—Ñ–µ–∫—Ç –∏ –æ–ø–∏—Å–∞–Ω–∏–µ" rows="2" style="resize: vertical;"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ensure only one role checkbox is selected
        const roleCheckboxes = document.querySelectorAll('#astral, #alien');
        roleCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    roleCheckboxes.forEach(other => {
                        if (other !== this) other.checked = false;
                    });
                }
            });
        });

        // Ensure only one racial gift stage is selected
        const giftCheckboxes = document.querySelectorAll('#not-awakened, #stage1, #stage2, #stage3');
        giftCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    giftCheckboxes.forEach(other => {
                        if (other !== this) other.checked = false;
                    });
                }
            });
        });

        // Add subtle glow effect to focused inputs
        const inputs = document.querySelectorAll('input, textarea');
        inputs.forEach(input => {
            input.addEventListener('focus', function() {
                this.style.boxShadow = '0 0 12px rgba(0, 245, 255, 0.4)';
            });
            
            input.addEventListener('blur', function() {
                this.style.boxShadow = '';
            });
        });

        // Image upload functionality
        const portraitCircle = document.getElementById('portraitCircle');
        const imageUpload = document.getElementById('imageUpload');
        const portraitImage = document.getElementById('portraitImage');
        const uploadText = document.getElementById('uploadText');

        portraitCircle.addEventListener('click', () => {
            imageUpload.click();
        });

        imageUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    portraitImage.src = e.target.result;
                    portraitImage.style.display = 'block';
                    uploadText.style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        });

        // Download as PNG functionality
        const downloadBtn = document.getElementById('downloadBtn');
        
        downloadBtn.addEventListener('click', async () => {
            // Temporarily hide the download button for cleaner export
            downloadBtn.style.display = 'none';
            
            // Create a temporary clone for export
            const originalSheet = document.querySelector('.character-sheet');
            const cloneSheet = originalSheet.cloneNode(true);
            
            // Apply comprehensive export styles
            const style = document.createElement('style');
            style.textContent = `
                .export-sheet {
                    position: fixed;
                    top: -20000px;
                    left: 0;
                    z-index: -1;
                    width: 794px !important;
                    min-height: 1123px !important;
                    background: #0F0B1A !important;
                    padding: 56px !important;
                    box-sizing: border-box !important;
                    font-family: 'Exo 2', sans-serif !important;
                    overflow: visible !important;
                }
                
                .export-sheet * {
                    box-sizing: border-box !important;
                }
                
                .export-sheet input, .export-sheet textarea {
                    color: #E0F7FA !important;
                    background: rgba(26, 20, 42, 0.9) !important;
                    border: 1px solid rgba(0, 245, 255, 0.6) !important;
                    font-family: 'Exo 2', sans-serif !important;
                    font-size: 9pt !important;
                    padding: 3px 6px !important;
                    border-radius: 3px !important;
                    word-wrap: break-word !important;
                    overflow: hidden !important;
                    text-overflow: ellipsis !important;
                    line-height: 1.2 !important;
                }
                
                .export-sheet textarea {
                    resize: none !important;
                    overflow: hidden !important;
                    white-space: pre-wrap !important;
                    word-break: break-word !important;
                }
                
                .export-sheet .attribute-value {
                    color: #00F5FF !important;
                    background: rgba(26, 20, 42, 0.9) !important;
                    border-bottom: 1px solid #00F5FF !important;
                    text-align: center !important;
                    font-weight: bold !important;
                    width: 30px !important;
                }
                
                .export-sheet .bonus-input {
                    color: #B87333 !important;
                    background: rgba(26, 20, 42, 0.9) !important;
                    border-bottom: 1px solid #B87333 !important;
                    text-align: center !important;
                    font-weight: bold !important;
                    width: 40px !important;
                }
                
                .export-sheet .field-line {
                    border: none !important;
                    border-bottom: 1px solid rgba(0, 245, 255, 0.6) !important;
                    background: transparent !important;
                    border-radius: 0 !important;
                }
                
                .export-sheet .section {
                    background: rgba(26, 20, 42, 0.4) !important;
                    border: 1px solid rgba(46, 26, 71, 0.7) !important;
                    margin-bottom: 30px !important;
                    padding: 30px !important;
                }
                
                .export-sheet .header {
                    background: linear-gradient(135deg, #2E1A47 0%, #0F0B1A 100%) !important;
                    height: 150px !important;
                    margin-bottom: 45px !important;
                    padding: 0 20px !important;
                }
                
                .export-sheet .portrait-circle {
                    width: 150px !important;
                    height: 150px !important;
                    border: 2px solid #00F5FF !important;
                    flex-shrink: 0 !important;
                }
                
                .export-sheet .main-content {
                    gap: 45px !important;
                    margin-bottom: 45px !important;
                }
                
                .export-sheet .bottom-section {
                    background: rgba(26, 20, 42, 0.4) !important;
                    border: 1px solid rgba(46, 26, 71, 0.7) !important;
                    padding: 45px !important;
                }
                
                .export-sheet .inventory-sections {
                    gap: 30px !important;
                }
                
                .export-sheet .field-label {
                    font-size: 9pt !important;
                    color: #E0F7FA !important;
                    margin-bottom: 6px !important;
                }
                
                .export-sheet .section-title {
                    font-size: 11pt !important;
                    color: #00F5FF !important;
                    margin-bottom: 30px !important;
                }
                
                .export-sheet .logo {
                    font-size: 16pt !important;
                    color: #00F5FF !important;
                }
                
                .export-sheet .sheet-title {
                    font-size: 14pt !important;
                    color: #E0F7FA !important;
                }
            `;
            document.head.appendChild(style);
            
            cloneSheet.classList.add('export-sheet');
            document.body.appendChild(cloneSheet);
            
            // Wait for styles to apply and fonts to load
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Use html2canvas library for better rendering
            try {
                // Load html2canvas if not already loaded
                if (!window.html2canvas) {
                    const script = document.createElement('script');
                    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
                    document.head.appendChild(script);
                    
                    await new Promise((resolve, reject) => {
                        script.onload = resolve;
                        script.onerror = reject;
                    });
                }
                
                const canvas = await html2canvas(cloneSheet, {
                    backgroundColor: '#0F0B1A',
                    scale: 1.5,
                    useCORS: true,
                    allowTaint: true,
                    width: 794,
                    height: cloneSheet.scrollHeight,
                    scrollX: 0,
                    scrollY: 0,
                    windowWidth: 794,
                    windowHeight: cloneSheet.scrollHeight,
                    logging: false,
                    removeContainer: true,
                    foreignObjectRendering: false
                });
                
                // Create download link
                const link = document.createElement('a');
                link.download = 'astraview-character-sheet.png';
                link.href = canvas.toDataURL('image/png', 0.95);
                link.click();
                
            } catch (error) {
                console.error('Export failed:', error);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–∏—Å—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä.');
            }
            
            // Cleanup
            document.body.removeChild(cloneSheet);
            document.head.removeChild(style);
            downloadBtn.style.display = 'block';
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'986ed44e87948d7b',t:'MTc1OTE4NDAyMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>


